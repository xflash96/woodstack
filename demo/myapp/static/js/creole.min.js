var Parse={};Parse.Simple||(Parse.Simple={});Parse.Simple.Base=function(f,d){if(arguments.length){this.grammar=f;this.grammar.root=new this.ruleConstructor(this.grammar.root);this.options=d}};Parse.Simple.Base.prototype={ruleConstructor:null,grammar:null,options:null,parse:function(f,d,c){if(c)for(i in this.options)typeof c[i]=="undefined"&&(c[i]=this.options[i]);else c=this.options;c.forIE&&(d=d.replace(/\r/g,""));this.grammar.root.apply(f,d,c);if(c.forIE)f.innerHTML=f.innerHTML.replace(/\n/g,"\r\n")}};
Parse.Simple.Base.prototype.constructor=Parse.Simple.Base;Parse.Simple.Base.Rule=function(f){if(arguments.length){for(var d in f)f.hasOwnProperty(d)&&(this[d]=f[d]);if(!this.children)this.children=[]}};Parse.Simple.Base.prototype.ruleConstructor=Parse.Simple.Base.Rule;
Parse.Simple.Base.Rule.prototype={regex:null,capture:null,replaceRegex:null,replaceString:null,tag:null,attrs:null,children:null,match:function(f){return f.match(this.regex)},build:function(f,d,c){var a;this.capture!==null&&(a=d[this.capture]);if(this.tag){d=document.createElement(this.tag);f.appendChild(d)}else d=f;if(a){this.replaceRegex&&(a=a.replace(this.replaceRegex,this.replaceString));this.apply(d,a,c)}if(this.attrs)for(var e in this.attrs)if(this.attrs.hasOwnProperty(e)){d.setAttribute(e,
this.attrs[e]);if(c.forIE&&e=="class")d.className=this.attrs[e]}return this},apply:function(f,d,c){var d=""+d,a=[];if(!this.fallback.apply)this.fallback=new this.constructor(this.fallback);for(;;){for(var e=false,g=false,b=0;b<this.children.length;b++){if(typeof a[b]==="undefined"){this.children[b].match||(this.children[b]=new this.constructor(this.children[b]));a[b]=this.children[b].match(d,c)}if(a[b]&&(!e||e.index>a[b].index)){e=a[b];g=this.children[b];if(e.index===0)break}}b=e?e.index:d.length;
b>0&&this.fallback.apply(f,d.substring(0,b),c);if(!e)break;g.build||(g=new this.constructor(g));g.build(f,e,c);e=e.index+e[0].length;d=d.substring(e);for(b=0;b<this.children.length;b++)if(a[b])a[b].index>=e?a[b].index=a[b].index-e:a[b]=void 0}return this},fallback:{apply:function(f,d){f.appendChild(document.createTextNode(d))}}};Parse.Simple.Base.Rule.prototype.constructor=Parse.Simple.Base.Rule;
Parse.Simple.Creole=function(f){var d=function(a,b){if(b instanceof Function)return b(a);b=b instanceof Array?b:[b];typeof b[1]=="undefined"&&(b[1]="");return b[0]+a+b[1]},c=function(a,b){return{tag:a,capture:1,regex:b+b+"([^"+b+"~]*(("+b+"(?!"+b+")|~(.|(?=\n)|$))[^"+b+"~]*)*)("+b+b+"|\n|$)"}},a={hr:{tag:"hr",regex:/(^|\n)\s*----\s*(\n|$)/},mdash:{regex:/ -- /,build:function(a){a.appendChild(document.createTextNode(" \u2014 "))}},br:{tag:"br",regex:/\\\\/},preBlock:{tag:"pre",capture:2,regex:/(^|\n)\{\{\{\n((.*\n)*?)\}\}\}(\n|$)/,
replaceRegex:/^ ([ \t]*\}\}\})/gm,replaceString:"$1"},tt:{tag:"tt",regex:/\{\{\{(.*?\}\}\}+)/,capture:1,replaceRegex:/\}\}\}$/,replaceString:""},ulist:{tag:"ul",capture:0,regex:/(^|\n)([ \t]*\*[^*#].*(\n|$)([ \t]*[^\s*#].*(\n|$))*([ \t]*[*#]{2}.*(\n|$))*)+/},olist:{tag:"ol",capture:0,regex:/(^|\n)([ \t]*#[^*#].*(\n|$)([ \t]*[^\s*#].*(\n|$))*([ \t]*[*#]{2}.*(\n|$))*)+/},li:{tag:"li",capture:0,regex:/[ \t]*([*#]).+(\n[ \t]*[^*#\s].*)*(\n[ \t]*\1[*#].+)*/,replaceRegex:/(^|\n)[ \t]*[*#]/g,replaceString:"$1"},
table:{tag:"table",capture:0,regex:/(^|\n)(\|.*?[ \t]*(\n|$))+/},tr:{tag:"tr",capture:2,regex:/(^|\n)(\|.*?)\|?[ \t]*(\n|$)/},th:{tag:"th",regex:/\|+=([^|]*)/,capture:1},td:{tag:"td",capture:1,regex:/\|+([^|~]*(~(.|(?=\n)|$)[^|~]*)*)/},singleLine:{regex:/.+/,capture:0},paragraph:{tag:"p",capture:0,regex:/(^|\n)([ \t]*\S.*(\n|$))+/},text:{capture:0,regex:/(^|\n)([ \t]*[^\s].*(\n|$))+/},monospace:c("tt","#"),superscript:c("sup","\\^"),subscript:c("sub",","),underline:c("u","_"),strike:c("strike","-"),
strong:c("strong","\\*"),inlineMath2:{tag:"script",capture:1,attrs:{type:"math/tex"},regex:"\\\\\\([ \t]*(.*?[^ \t])[ \t]*\\\\\\)"},displayMath2:{tag:"script",capture:1,attrs:{type:"math/tex; mode=display"},regex:"\\\\\\[[ \t]*(.*?[^ \t])[ \t]*\\\\\\]"},displayMath3:{tag:"script",capture:1,attrs:{type:"math/tex; mode=display"},regex:"\\\\begin\\{equation\\}[ \t]*(.*?[^ \t])[ \t]*\\\\end\\{equation\\}"},displayMath4:{tag:"script",capture:1,attrs:{type:"math/tex; mode=display"},regex:"\\\\begin\\{eqnarray\\}[ \t]*(.*?[^ \t])[ \t]*\\\\end\\{eqnarray\\}"},
em:{tag:"em",capture:1,regex:"\\/\\/(((?!\\b(?:(?:https?|ftp)://|mailto:))[^\\/~])*((\\b(?:(?:https?|ftp)://|mailto:)\\S*[^\\s!\"',.:;?]|\\/(?!\\/)|~(.|(?=\\n)|$))((?!\\b(?:(?:https?|ftp)://|mailto:))[^\\/~])*)*)(\\/\\/|\\n|$)"},img:{regex:"{{((?!\\{)[^|}\\n]*(?:}(?!})[^|}\\n]*)*)\\|([^\\|}~\\n]*((}(?!})|~.)[^\\|}~\\n]*)*)(?:\\|([a-z]+)=([a-zA-Z0-9%]+))?}}",build:function(a,b){var d=document.createElement("img");d.src=b[1];d.alt=b[2].replace(/~(.)/g,"$1");if(b[5]!==void 0&&b[6]!==void 0)b[5]==="width"?
d.style.width=b[6]:b[5]=="height"?d.style.height=b[6]:d[b[5]]=b[6];a.appendChild(d)}},namedUri:{regex:"\\[\\[(\\b(?:(?:https?|ftp)://|mailto:)[^\\]|~\\n]*(?:(?:\\](?!\\])|~.)[^\\]|~\\n]*)*)\\|([^\\]~\\n]*(?:(?:\\](?!\\])|~.)[^\\]~\\n]*)*)\\]\\]",build:function(a,b,d){var c=document.createElement("a");c.href=b[1];d&&d.isPlainUri?c.appendChild(document.createTextNode(b[2])):this.apply(c,b[2],d);a.appendChild(c)}},namedLink:{regex:"\\[\\[([^\\]|~\\n]*(?:(?:\\](?!\\])|~.)[^\\]|~\\n]*)*)\\|([^\\]~\\n]*(?:(?:\\](?!\\])|~.)[^\\]~\\n]*)*)\\]\\]",
build:function(a,b,c){var e=document.createElement("a");e.href=c&&c.linkFormat?d(b[1].replace(/~(.)/g,"$1"),c.linkFormat):b[1].replace(/~(.)/g,"$1");this.apply(e,b[2],c);a.appendChild(e)}},unnamedUri:{regex:"\\[\\[(\\b(?:(?:https?|ftp)://|mailto:)[^\\]|~\\n]*(?:(?:\\](?!\\])|~.)[^\\]|~\\n]*)*)\\]\\]",build:"dummy"},unnamedLink:{regex:"\\[\\[([^\\]|~\\n]*(?:(?:\\](?!\\])|~.)[^\\]|~\\n]*)*)\\]\\]",build:"dummy"},unnamedInterwikiLink:{regex:"\\[\\[([\\w.]+:[^\\]|~\\n]*(?:(?:\\](?!\\])|~.)[^\\]|~\\n]*)*)\\]\\]",
build:"dummy"},rawUri:{regex:"(\\b(?:(?:https?|ftp)://|mailto:)\\S*[^\\s!\"',.:;?])",build:"dummy"},escapedSequence:{regex:"~(\\b(?:(?:https?|ftp)://|mailto:)\\S*[^\\s!\"',.:;?]|.)",capture:1,tag:"span",attrs:{"class":"escaped"}},escapedSymbol:{regex:/~(.)/,capture:1,tag:"span",attrs:{"class":"escaped"}}};a.unnamedUri.build=a.rawUri.build=function(d,b,c){c||(c={});c.isPlainUri=true;a.namedUri.build.call(this,d,[b[0],b[1],b[1]],c)};a.unnamedLink.build=function(c,b,d){a.namedLink.build.call(this,c,
[b[0],b[1],b[1]],d)};a.namedInterwikiLink={regex:"\\[\\[([\\w.]+:[^\\]|~\\n]*(?:(?:\\](?!\\])|~.)[^\\]|~\\n]*)*)\\|([^\\]~\\n]*(?:(?:\\](?!\\])|~.)[^\\]~\\n]*)*)\\]\\]",build:function(c,b,e){var f=document.createElement("a"),h,j;if(e&&e.interwiki){h=b[1].match(/(.*?):(.*)/);j=e.interwiki[h[1]]}if(typeof j=="undefined"){if(!a.namedLink.apply)a.namedLink=new this.constructor(a.namedLink);return a.namedLink.build.call(a.namedLink,c,b,e)}f.href=d(h[2].replace(/~(.)/g,"$1"),j);this.apply(f,b[2],e);c.appendChild(f)}};
a.unnamedInterwikiLink.build=function(c,b,d){a.namedInterwikiLink.build.call(this,c,[b[0],b[1],b[1]],d)};a.namedUri.children=a.unnamedUri.children=a.rawUri.children=a.namedLink.children=a.unnamedLink.children=a.namedInterwikiLink.children=a.unnamedInterwikiLink.children=[a.escapedSymbol,a.img];for(c=1;c<=6;c++)a["h"+c]={tag:"h"+c,capture:2,regex:"(^|\\n)[ \\t]*={"+c+"}[ \\t]([^~]*?(~(.|(?=\\n)|$))*)[ \\t]*=*\\s*(\\n|$)"};a.ulist.children=a.olist.children=[a.li];a.li.children=[a.ulist,a.olist];a.li.fallback=
a.text;a.table.children=[a.tr];a.tr.children=[a.th,a.td];a.td.children=[a.singleLine];a.th.children=[a.singleLine];var c=[a.escapedSequence,a.mdash,a.monospace,a.superscript,a.subscript,a.underline,a.strike,a.strong,a.em,a.br,a.rawUri,a.namedUri,a.namedInterwikiLink,a.namedLink,a.unnamedUri,a.unnamedInterwikiLink,a.unnamedLink,a.tt,a.img],e=[a.inlineMath2,a.displayMath2,a.displayMath3,a.displayMath4].concat(c);a.h1.children=a.h2.children=a.h3.children=a.h4.children=a.h5.children=a.h6.children=a.singleLine.children=
a.paragraph.children=a.text.children=e;a.monospace.children=a.superscript.children=a.subscript.children=a.underline.children=a.strike.children=a.strong.children=a.em.children=c;a.root={children:[a.h1,a.h2,a.h3,a.h4,a.h5,a.h6,a.hr,a.ulist,a.olist,a.preBlock,a.table],fallback:{children:[a.paragraph]}};Parse.Simple.Base.call(this,a,f)};Parse.Simple.Creole.prototype=new Parse.Simple.Base;Parse.Simple.Creole.prototype.constructor=Parse.Simple.Creole;
